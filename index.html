<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>English Sentence Structure Analyzer (MVP-A)</title>

<!-- CDN with local fallback -->
<script src="https://cdn.jsdelivr.net/npm/compromise@14.10.0/builds/compromise.min.js"></script>
<script>
if (typeof nlp === 'undefined') {
  document.write('<script src="vendor/compromise.min.js"><\/script>');
}
</script>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f6fb;
  margin: 0;
  padding: 24px;
}
.container {
  max-width: 960px;
  margin: auto;
  background: white;
  padding: 28px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}
h1 {
  margin-top: 0;
  text-align: center;
}
textarea {
  width: 100%;
  height: 110px;
  font-size: 16px;
  padding: 12px;
  box-sizing: border-box;
}
button {
  margin: 8px 6px;
  padding: 8px 18px;
  font-size: 15px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}
button.primary { background:#2563eb; color:white; }
button.secondary { background:#e5e7eb; }

.notice {
  font-size: 14px;
  color: #555;
  margin: 10px 0;
}

.output {
  margin-top: 20px;
  line-height: 2.0;
}

.token {
  display: inline-block;
  margin: 0 2px;
  position: relative;
}

.S { color: #1d4ed8; font-weight: 600; }
.V { color: #b91c1c; font-weight: 600; }
.s { color: #047857; font-weight: 600; }
.v { color: #7c3aed; font-weight: 600; }

.badge {
  position: absolute;
  top: -1.2em;
  left: 50%;
  transform: translateX(-50%);
  font-size: 10px;
  padding: 1px 4px;
  border-radius: 4px;
  color: white;
}
.S .badge { background:#1d4ed8; }
.V .badge { background:#b91c1c; }
.s .badge { background:#047857; }
.v .badge { background:#7c3aed; }

.clause {
  border: 2px solid;
  padding: 8px 6px 10px 6px;
  border-radius: 10px;
  margin: 12px 0;
}
.main { border-color:#9ca3af; }
.sub { border-color:#f59e0b; }
.rel { border-color:#8b5cf6; }

.label {
  font-size: 11px;
  font-weight: 700;
  color: white;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
  margin-bottom: 6px;
}
.main .label { background:#6b7280; }
.sub .label { background:#f59e0b; }
.rel .label { background:#8b5cf6; }

footer {
  margin-top: 28px;
  font-size: 13px;
  color:#666;
}
code { background:#eee; padding:2px 4px; border-radius:4px; }
</style>
</head>

<body>
<div class="container">

<h1>English Sentence Structure Analyzer</h1>

<p class="notice">
<strong>Design policy (MVP-A):</strong><br>
• Educational visualization tool (not a full parser)<br>
• Shows <em>clauses</em> and exactly <em>one Subject (S) and one finite Verb (V)</em> per clause<br>
• Finite verbs only (be / have / modals / present & past forms)<br>
• Robust on GitHub Pages (Safari / campus Wi‑Fi)
</p>

<textarea id="input">
When I arrived, the woman who lives next door has been making dinner for my dad, mom and brother.
The man with whom I spoke had gone back home, but the book that I bought yesterday was expensive.
I go home.
</textarea>

<div style="text-align:center">
  <button class="primary" onclick="analyze()">Analyze</button>
  <button class="secondary" onclick="clearOutput()">Clear</button>
</div>

<div id="output" class="output"></div>

<footer>
Tip: If CDN fails, place <code>compromise.min.js</code> at <code>/vendor/compromise.min.js</code>.
</footer>

</div>

<script>
/*
==================================================
 CORE LOGIC — MVP A (FIXED SPEC)
==================================================
*/

const SUBORDINATORS = ["when","if","because","although","while"];
const RELATIVES = ["who","whom","which","that","whose","where"];

const FINITE_VERBS = [
  "am","is","are","was","were",
  "have","has","had",
  "will","can","may","must","should","did"
];

function isFiniteVerb(word) {
  const w = word.toLowerCase();
  if (FINITE_VERBS.includes(w)) return true;
  if (w.endsWith("ed")) return true;      // simple past
  if (w.endsWith("s")) return true;       // 3sg present
  return false;
}

function tokenize(text) {
  return text.split(/(\s+|[.,])/).filter(t => t.trim() !== "");
}

function analyzeSentence(sentence) {
  const tokens = tokenize(sentence);
  let clauses = [];
  let i = 0;

  function readClause(type) {
    let S = null, V = null;
    let content = [];
    while (i < tokens.length) {
      const t = tokens[i];
      const lw = t.toLowerCase();

      if (type !== "rel" && RELATIVES.includes(lw)) break;
      if (type === "main" && SUBORDINATORS.includes(lw)) break;

      if (!S && /^[A-Za-z]/.test(t)) S = t;
      else if (!V && isFiniteVerb(t)) V = t;

      content.push(t);
      i++;
      if (V) break; // MVP rule: stop after finite V
    }
    clauses.push({ type, content, S, V });
  }

  while (i < tokens.length) {
    const w = tokens[i].toLowerCase();
    if (SUBORDINATORS.includes(w)) {
      i++;
      readClause("sub");
    } else if (RELATIVES.includes(w)) {
      i++;
      readClause("rel");
    } else {
      readClause("main");
    }
  }
  return clauses;
}

function renderClause(cl) {
  let cls = cl.type;
  let label = cl.type === "main" ? "Main Clause" :
              cl.type === "sub" ? "Subordinate Clause" :
              "Relative Clause";

  let html = `<div class="clause ${cls}"><div class="label">${label}</div>`;
  cl.content.forEach(tok => {
    let c = "token";
    if (tok === cl.S) c += " S";
    if (tok === cl.V) c += " V";
    html += `<span class="${c}">${tok}`;
    if (tok === cl.S) html += `<span class="badge">S</span>`;
    if (tok === cl.V) html += `<span class="badge">V</span>`;
    html += `</span>`;
  });
  html += "</div>";
  return html;
}

function analyze() {
  const text = document.getElementById("input").value;
  const out = document.getElementById("output");
  out.innerHTML = "";

  const sentences = nlp(text).sentences().out("array");
  sentences.forEach(s => {
    const clauses = analyzeSentence(s);
    clauses.forEach(c => out.innerHTML += renderClause(c));
  });
}

function clearOutput() {
  document.getElementById("output").innerHTML = "";
}
</script>

</body>
</html>
